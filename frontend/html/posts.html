<!-- <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
---- Include the above in your HEAD tag -------- -->

<!DOCTYPE html>
<html>

<head>
    <title>Login Page</title>
    <!--Made with love by Mutiullah Samim -->

    <!--Bootsrap 4 CDN-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <!--Fontawesome CDN-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
        integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
        <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!--Custom styles-->
    <link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>
    <ul>
        <form action="/logout.html">
          <input type="submit" class="logout" value="Logout" />
        </form>
      </ul>
    <h1 class="substyle" id="allposts">All POSTS</h1>
    <div id="data"></div>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
    <script>
        if(sessionStorage.getItem("role")!="student"&&sessionStorage.getItem("role")!="teacher")
      window.history.back()
        let parent=``;
       const id=sessionStorage.getItem("topic");
       fetch(`http://localhost:3000/discussion/fetchposts`, {
        method: "POST",
        body: JSON.stringify({
         id
        }),
        headers: {
          "Content-type": "application/json; charset=UTF-8",
          'Accept': 'application/json'
        }
      })
        .then(response => {
          return response.json()
        })
        .then(response => {
            console.log(response)
            const result=response.data;
           let htmlCode=``;
            if(result.length==0)
            {
              document.querySelector("#allposts").innerHTML="NO POST"
             let  htmlCode =
        `
        <div class="card1 empty pt" style="width: 18rem;">
            <img class="card-img-top img-fluid thumbnailImage " src="/img/empty.png" alt="">
        </div>
  `;
  const container=document.querySelector("#data")
            container.innerHTML=htmlCode;
            }
            else{
            for(let c=0;c<result.length;c++) {
      htmlCode =
        htmlCode +
        `
        <div class="posts">
            <div class="row bottom">
                        <h6 class="timestamp create">
                             ${result[c].author}
                        </h6>
                        <p class="createpost">
                            Created at: ${result[c].created_at}
                        </p>
                    </div>
                    <h6 class="parentpost">${result[c].parent}<h6>
                    <h6 class="descpost">
                        ${result[c].description}
                    </h6>
                    <button style="font-size:12px" class="reply" onclick='place("${result[c].author}","${result[c].description}","#topic")' >Reply<i class="fa fa-mail-reply"></i></button>
        </div>
  `;
    }
    const cards = document.querySelector("#data");
    cards.innerHTML=htmlCode
            }
        })

        function place(author,description,url){
            document.getElementById("tdesc").innerHTML=`<h6>${author} - ${description}<h6>`
             parent=`${author} - ${description}`;
              document.getElementById("topic").scrollIntoView();
        }

        function call(){
            fetch(`http://localhost:3000/discussion/submitposts`, {
        method: "POST",
        body: JSON.stringify({
         topic_id:id,
         role:sessionStorage.getItem("role"),
         token:sessionStorage.getItem("token"),
         description:document.querySelector("#description").value.replace(/'/g,''),
         parent
        }),
        headers: {
          "Content-type": "application/json; charset=UTF-8",
          'Accept': 'application/json'
        }
      })
        .then(response => {
          return response.json()
        })
        .then(response => {
            window.location.href = "/posts.html";
        })
        }
    </script>
    <h1 class="add">Add New Post</h1>
    <div class="topic" id="topic">
     <div class="row">
      <h6 class="tdesc" id="tdesc">Description:</h6>
      <!-- <p class="rep" id="rep"></p> -->
      <input type="text" class="idesc" id="description">
      </div>
      <button type="butto" onclick="call()" class="tsubmit">Submit</button>
    </div>
    <div id="data"></div>
</body>

</html>